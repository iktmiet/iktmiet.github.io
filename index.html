<!DOCTYPE html>
<html lang="ru">
    <head>
        <meta charset="UTF-8">
        <!-- –®–†–ò–§–¢–´ -->
        <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Nunito:wght@400;600&display=swap">
        <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Manrope:wght@400;600&display=swap">
        <link rel="stylesheet" href="https://fonts.googleapis.com/icon?family=Material+Icons">  
        <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@24,400,0,0" />
        
        <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
        <title>–ò–ö–¢ –ú–ò–≠–¢</title>
    
        <!-- PWA -->
        <link rel="manifest" href="manifest.json">
        <link rel="import" href="meta.html">

        <!-- –°–¢–ò–õ–ò -->
        <link rel="stylesheet" href="styles/main.css" />
        <link rel="stylesheet" href="styles/modalWindow.css" />
        <link rel="stylesheet" href="styles/legend.css" />
        <link rel="stylesheet" href="styles/stories.css" />
        <link rel="stylesheet" href="styles/schedule.css" />

        <!-- –°–ö–†–ò–ü–¢–´ -->
        <script src="scripts/stories.js"></script>
        <script src="scripts/global_stories.js"></script>

        <!-- –ò–ö–û–ù–ö–ê -->
        <link rel="icon"          type="image/x-icon" href="./icons/logo.ico">
        <link rel="shortcut icon" type="image/x-icon" href="./icons/logo.ico">
    </head>

    <body>
        <!-- –ó–∞–ø—É—Å–∫ –ø—Ä–∏–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ–≥–æ –æ–∫–Ω–∞ –ø—Ä–∏ –ø–µ—Ä–≤–æ–º –∑–∞–ø—É—Å–∫–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è -->
        <script>
            // –ü—Ä–æ–≤–µ—Ä—è–µ–º, –±—ã–ª–∞ –ª–∏ —Å—Ç—Ä–∞–Ω–∏—Ü–∞ —É–∂–µ –æ—Ç–∫—Ä—ã—Ç–∞
            var isNotFirstVisit = localStorage.getItem('isNotFirstVisit');

            if (!isNotFirstVisit) {
                // –ï—Å–ª–∏ —ç—Ç–æ –ø–µ—Ä–≤–æ–µ –ø–æ—Å–µ—â–µ–Ω–∏–µ, –ø–µ—Ä–µ–∞–¥—Ä–µ—Å–æ–≤—ã–≤–∞–µ–º
                window.location.href = 'welcome';
                // –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º —Ñ–ª–∞–≥ –æ —Ç–æ–º, —á—Ç–æ —Å—Ç—Ä–∞–Ω–∏—Ü–∞ –±—ã–ª–∞ –æ—Ç–∫—Ä—ã—Ç–∞
                localStorage.setItem('isNotFirstVisit', 'true');
            }
        </script>

        <!-- ------ -->
        <!-- –•–ï–ê–î–ï–† -->
        <!-- ------ -->

        <header>
            <h1>–†–∞—Å–ø–∏—Å–∞–Ω–∏–µ</h1>

            <!-- –ö–Ω–æ–ø–∫–∏ (–≤–µ—Ä—Ö–Ω–∏–π –±–ª–æ–∫) -->

            <div class="button-container">
                <button style="margin-right:5px" id="numeratorBtn" class="active-button" onclick="changeSchedule('numerator')">
                    –ß–∏—Å–ª–∏—Ç–µ–ª—å
                    <span id="numeratorCircle" class="num-notification"></span>
                </button>

                <button style="margin-left: 5px;" id="denominatorBtn" class="inactive-button" onclick="changeSchedule('denominator')">
                    –ó–Ω–∞–º–µ–Ω–∞—Ç–µ–ª—å
                    <span id="denominatorCircle" class="den-notification"></span>
                </button>
            </div>

            <!-- –†–ê–ó–î–ï–õ–ò–¢–ï–õ–¨ -->

            <br />

            <!-- –ö–Ω–æ–ø–∫–∏ (–Ω–∏–∂–Ω–∏–π –±–ª–æ–∫) -->

            <button id="booksBtn" style="margin-right: 10px; margin-bottom: 20px;" class="additional-button" onclick="redirectToBooksPage()">
                üìö
                <script>
                    function redirectToBooksPage() {
                        window.location.href = 'books';
                    }
                </script>
            </button>

            <button id="linksBtn" style="margin-right: 10px; margin-bottom: 20px;" class="additional-button" onclick="redirectToLinksPage()">
                üîó
                <script>
                    function redirectToLinksPage() {
                        window.location.href = 'links';
                    }
                </script>
            </button>

            <button 
                id="todayBtn" 
                style="margin-right: 10px; margin-bottom: 20px;" 
                class="additional-button" 
                onclick="goToCurrentDay();"
            >
                –°–µ–≥–æ–¥–Ω—è

                <script>
                    function goToCurrentDay() {
                        // –û–ü–†–ï–î–ï–õ–ï–ù–ò–ï –¢–ï–ö–£–©–ï–ì–û –î–ù–Ø –ù–ï–î–ï–õ–ò
                        var day = new Date().getDay();
                        var anchorId;

                        switch (day) {
                            case 1:
                                anchorId = 'MondayLinkAnchor';
                                break;
                            case 2:
                                anchorId = 'TuesdayLinkAnchor';
                                break;
                            case 3:
                                anchorId = 'WednesdayLinkAnchor';
                                break;
                            case 4:
                                anchorId = 'ThursdayLinkAnchor';
                                break;
                            case 5:
                                anchorId = 'FridayLinkAnchor';
                                break;
                            case 6:
                                anchorId = 'SaturdayLinkAnchor';
                                break;
                            case 0:
                                anchorId = 'SundayLinkAnchor';
                                break;
                        }

                        document.getElementById(anchorId).scrollIntoView({ behavior: 'smooth' });
                    }
                </script>
            </button>

        </header>

        
        <!-- –õ–ï–ì–ï–ù–î–ê -->
        <!-- –û –ë–û–ì–ò–ù–ï –ú–ï–ß–ï–ô-->

        <div class='my-legend' style="margin-top: 15px;">
            <div class='legend-scale'>
                <ul class='legend-labels'>
                    <li><span style='background:var(--event);'></span><b id="weekLegend">–û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –Ω–µ–¥–µ–ª–∏... –û–±–æ–∂–¥–∏—Ç–µ...</b></li>
                </ul>
            </div>
        </div>


        <!-- -------------- -->
        <!--   –†–ê–°–ü–ò–°–ê–ù–ò–ï   -->
        <!-- -------------- -->
        <!--    –ß–ò–°–õ–ò–¢–ï–õ–¨   -->
        <!-- -------------- -->

        <script src="scripts/global_numerator_schedule.js"></script>
        <script>
            var numeratorSchedule = NUMERATOR_SCHEDULE;
        </script>

        <!-- -------------- -->
        <!--   –ó–ù–ê–ú–ï–ù–ê–¢–ï–õ–¨  -->
        <!-- -------------- -->

        <script>
            function openRecordLink() {
                window.open('https://docs.google.com/forms/d/e/1FAIpQLScDCEhx35cwP3-Pzh72DMrtTYK7R3yXQdOjTg-eMOhWbUQUnQ/viewform', '_blank');
            }
        </script>

        <script src="scripts/global_denominator_schedule.js"></script>
        <script>
            var denominatorSchedule = DENOMINATOR_SCHEDULE;
        </script>

        <!-- ----------------- -->
        <!--     –°–ö–†–ò–ü–¢ –î–õ–Ø    -->
        <!--     –û–ü–†–ï–î–ï–õ–ï–ù–ò–Ø   -->
        <!--   –¢–ï–ö–£–©–ï–ô –ù–ï–î–ï–õ–ò  -->
        <!-- ----------------- -->

        <script src="scripts/getCurrentWeek.js"></script>
        <script>document.addEventListener("DOMContentLoaded", function() {getCurrentWeek();});</script>

        <!-- ----------------- -->
        <!--   –û–¢–û–ë–†. –õ–ï–ì–ï–ù–î–´  -->
        <!-- ----------------- -->

        <div class='my-legend'>
            <div class='legend-scale'>
                <ul class='legend-labels'>
                    <li><span style='background:var(--lecture);'></span>–õ–µ–∫—Ü–∏—è</li>
                    <li><span style='background:var(--seminar);'></span>–°–µ–º–∏–Ω–∞—Ä</li>
                    <li><span style='background:var(--lab);'></span>–õ–∞–±–æ—Ä–∞—Ç–æ—Ä–Ω–∞—è</li>
                </ul>
            </div>
        </div>
        
        <!-- ----------------- -->

        <!--  –ë–õ–û–ö –†–ê–°–ü–ò–°–ê–ù–ò–Ø  -->

        <!-- ----------------- -->

        <script src="scripts/modal_window.js"></script>

        <div class="schedule-container">
            <div class="stories-block">
                <div 
                    class="story unviewedBn" 
                    data-story-id="ban"
                    style="background: url('https://iktmiet.github.io/banUser.png');
                        background-size: contain;
                        aspect-ratio: 1/1;"
                > </div>
                <span style="color:#fff; display: flex; justify-content: right; align-items: center; font-weight: 800;">–í–ù–ò–ú–ê–ù–ò–ï! –î–æ—Å—Ç—É–ø –Ω–∞ —Å–∞–π—Ç –î–º–∏—Ç—Ä–∏—é –°—É–º–∏–Ω—É –∑–∞–ø—Ä–µ—â—ë–Ω!</span>
            </div>
        </div>

        <div class="schedule-container">
            <!-- ----------------- -->
            <!--     –ò–ù–§–û–†–ú–ê–¶–ò–Ø    -->
            <!-- ----------------- -->
            <script>
                checkViews('comStory')
                checkViews('scheduleStory')
                checkViews('updateStory')
            </script>
            
            <div class="stories-block">
                <div 
                    class="story unviewed" 
                    onclick="openStoriesPage('comStory')" 
                    data-story-id="comStory"
                    style="background: linear-gradient(45deg, #FC6, #FCC);"
                >
                    <i class="material-symbols-outlined time-icon" style="font-size: 36px; color: black;">event</i>
                </div>

                <div 
                    class="story unviewed" 
                    onclick="openStoriesPage('scheduleStory')" 
                    data-story-id="scheduleStory"
                    style="background: linear-gradient(45deg, #acf7a9, #a1e3fd);"
                >
                    <i class="material-symbols-outlined time-icon" style="font-size: 36px; color: black;">schedule</i>
                </div>
            </div>

            <div class="schedule-container">
                <div class="stories-block" style="border:3px solid #fff000">
                    <span style="display: flex; justify-content: right; align-items: center; margin-left:30px; font-weight: 800;">–†–∞—Å–ø–∏—Å–∞–Ω–∏–µ —Å–µ—Å—Å–∏–∏ –∏ —ç–∫–∑–∞–º–µ–Ω–æ–≤ —É–∂–µ –¥–æ—Å—Ç—É–ø–Ω–æ.</span>
                    <button id="sessionBtn" style="display: flex; margin:30px; margin-left: 30px; justify-content: right; align-items: center;" class="active-button" onclick="redirectToSessionPage()">
                    –û—Ç–∫—Ä—ã—Ç—å
                    <script>
                        function redirectToSessionPage() {
                            window.location.href = 'session/index.html';
                        }
                    </script>
                </button>
                </div>
            </div>
        
            <!-- ----------------- -->
            <!--     –†–ê–°–ü–ò–°–ê–ù–ò–ï    -->
            <!--     –ù–ê –ù–ï–î–ï–õ–Æ     -->
            <!-- ----------------- -->
            <div id="scheduleContainer" class="schedule-container">
            </div>

            <script>
                // –°–∫—Ä–∏–ø—Ç –¥–ª—è –∏–∑–º–µ–Ω–µ–Ω–∏—è —Ä–∞—Å–ø–∏—Å–∞–Ω–∏—è
                function changeSchedule(scheduleType) {
                    // –ü–æ–ª—É—á–∞–µ–º —ç–ª–µ–º–µ–Ω—Ç—ã –∫–Ω–æ–ø–æ–∫
                    var numeratorBtn = document.getElementById("numeratorBtn");
                    var denominatorBtn = document.getElementById("denominatorBtn");
                    var scheduleContainer = document.getElementById("scheduleContainer");
                    
                    if (scheduleType === 'numerator') {
                        // –ò–∑–º–µ–Ω–µ–Ω–∏—è –¥–ª—è –ß–∏—Å–ª–∏—Ç–µ–ª—è
                        numeratorBtn.classList.remove("inactive-button");
                        numeratorBtn.classList.add("active-button");
                        denominatorBtn.classList.remove("active-button");
                        denominatorBtn.classList.add("inactive-button");
                        
                        scheduleContainer.innerHTML = numeratorSchedule;

                    } else if (scheduleType === 'denominator') {
                        // –ò–∑–º–µ–Ω–µ–Ω–∏—è –¥–ª—è –ó–Ω–∞–º–µ–Ω–∞—Ç–µ–ª—è
                        numeratorBtn.classList.remove("active-button");
                        numeratorBtn.classList.add("inactive-button");
                        denominatorBtn.classList.remove("inactive-button");
                        denominatorBtn.classList.add("active-button");

                        scheduleContainer.innerHTML = denominatorSchedule;
                    }
                }
            </script>
        </div>


        <!-------------->
        <!-- –ê–ù–ï–ö–î–û–¢–´ -->
        <!-------------->

        <div class="schedule-container">
            <div class="day-block" style="background-color: #212121;">
                <div class="day-title" style="background-color: #2a2a2a;">–ê–ù–ï–ö–î–û–¢ –î–ù–Ø</div>
                <div class="class-item practice">
                    <div id="anekdotText">
                        –ò—â–µ–º –¥–ª—è –≤–∞—Å —Å–∞–º—ã–π —Å–º–µ—à–Ω–æ–π –∞–Ω–µ–∫–¥–æ—Ç –¥–Ω—è...
                    </div>
                </div>
            </div>
        </div>

        <script>
            // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –∑–∞–≥—Ä—É–∑–∫–∏ –∏ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è —Å–ª—É—á–∞–π–Ω–æ–≥–æ –∞–Ω–µ–∫–¥–æ—Ç–∞
            function loadRandomAnekdot() {
                // API –¥–ª—è –æ–±—Ö–æ–¥–∞ CORS –∏ –ø–æ–ª—É—á–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö –≤ —Ñ–æ—Ä–º–∞—Ç–µ JSON
                var apiUrl = 'https://api.allorigins.win/get?url=' + encodeURIComponent('https://www.anekdot.ru/rss/export_j.xml');

                // –ó–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö
                fetch(apiUrl)
                    .then(response => response.json())
                    .then(data => {
                        // –ò–∑–≤–ª–µ—á–µ–Ω–∏–µ –∞–Ω–µ–∫–¥–æ—Ç–æ–≤ –∏–∑ RSS
                        var parser = new DOMParser();
                        var xmlDoc = parser.parseFromString(data.contents, 'text/xml');
                        var items = xmlDoc.getElementsByTagName('item');
                        
                        // –í—ã–±–æ—Ä —Å–ª—É—á–∞–π–Ω–æ–≥–æ –∞–Ω–µ–∫–¥–æ—Ç–∞
                        var randomIndex = Math.floor(Math.random() * items.length);
                        var randomAnekdot = items[randomIndex].getElementsByTagName('description')[0].textContent;

                        // –û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ —Ç–µ–∫—Å—Ç–∞ –∞–Ω–µ–∫–¥–æ—Ç–∞
                        document.getElementById('anekdotText').innerHTML = randomAnekdot;
                    })
                    .catch(error => console.error('ü•∫ –û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –∞–Ω–µ–∫–¥–æ—Ç–æ–≤:', error));
            }

            // –ó–∞–≥—Ä—É–∑–∫–∞ —Å–ª—É—á–∞–π–Ω–æ–≥–æ –∞–Ω–µ–∫–¥–æ—Ç–∞ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
            window.addEventListener('load', loadRandomAnekdot);
        </script>

        <!-- –¢–µ–∫—Å—Ç –≤ –Ω–∏–∑—É —Å—Ç—Ä–∞–Ω–∏—Ü—ã -->

        <div class="footer-text" style="padding-bottom: 20px;">
            –ë–ê–ó–ê –ò–ö–¢-11 | –ú–ò–≠–¢ 2024
            <br/>
            <div class="alpha50"><div id="lastUpdate"></div></div>
            <br />
            <br />
            <div id="version">–í–µ—Ä—Å–∏—è 2.X.X (...) | dev: @eagalts</div>

            <script src="scripts/global_var.js"></script>
            <script>
                document.getElementById('lastUpdate').innerHTML = `–ü–û–°–õ–ï–î–ù–ï–ï –û–ë–ù–û–í–õ–ï–ù–ò–ï: ${appInfo.lastUpdate}`;
                document.getElementById('version').innerHTML = `ver: ${appInfo.version} | dev: @eagalts`;
            </script>
        </div>
    </body>
</html>
